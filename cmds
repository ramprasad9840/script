helm repo add eks https://aws.github.io/eks-charts
helm repo update

serviceAccount:
  create: false
  name: fluent-bit

# âœ… THESE MUST BE TOP-LEVEL
extraVolumes:
  - name: host-application-logs
    hostPath:
      path: /logs
      type: Directory

extraVolumeMounts:
  - name: host-application-logs
    mountPath: /mnt/node-logs
    readOnly: true

input:
  enabled: false

extraInputs: |
  [INPUT]
      Name              tail
      Path              /mnt/node-logs/*/*.log
      Tag               debtwizard.*
      DB                /var/fluent-bit/state/debtwizard.db
      Refresh_Interval  10

filter:
  enabled: false

extraFilters: |
  [FILTER]
      Name              kubernetes
      Match             debtwizard.*

output:
  enabled: false

extraOutputs: |
  [OUTPUT]
      Name                opensearch
      Match               debtwizard.*
      Host                vpc-uat-oss-sa4m7otu6ck4fmp4fy2l5wkoce.us-east-1.es.amazonaws.com
      Port                443
      TLS                 On
      AWS_Auth            On
      AWS_Region          us-east-1
      AWS_Service_Name    es
      Index               debtwizard-logs

helm install fluent-bit \
  eks/aws-for-fluent-bit \
  -n logging \
  -f values.yaml

https://raw.githubusercontent.com/aws-samples/amazon-cloudwatch-container-insights/latest/k8s-deployment-manifest-templates/deployment-mode/daemonset/container-insights-monitoring/fluent-bit/fluent-bit.yaml
